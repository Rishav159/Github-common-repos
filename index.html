<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Github Common Repositories</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <br>
    <div id='wrapper'>
      First : <input id='first' type="text" name="1" value=""><br>
    Second : <input id = 'second' type="text" name="1" value=""><br>
     <br>
      <input type="button" onclick='findCommonRepos()' value="Find out" class="butn"><br><br>
      <input type="button" onclick='findCommonfollowers()' value="Find Common followers" class="butn"><br><br>
    </div>
    <div id = "total">

    </div>
    <div id="repos">

    </div>
    <div id="repos">

    </div>
  </body>
  <script type="text/javascript" src='jquery.js'></script>
  <script type="text/javascript">
  function findCommonRepos(){
    var first = $('#first').val();
    var second = $('#second').val();
    var firstmember = $.ajax({
      url : 'https://api.github.com/users/'+first+'/repos?type=member',
      method : 'GET'
    });
    var firstowner = $.ajax({
      url : 'https://api.github.com/users/'+first+'/repos?type=owner',
      method : 'GET'
    });
    var secondmember = $.ajax({
      url : 'https://api.github.com/users/'+second+'/repos?type=member',
      method : 'GET'
    });
    var secondowner = $.ajax({
      url : 'https://api.github.com/users/'+second+'/repos?type=owner',
      method : 'GET'
    });
    $.when(firstmember,firstowner,secondmember,secondowner).done(function(fm,fo,sm,so){
      fm = fm[0];
      fo = fo[0];
      sm = sm[0];
      so = so[0];
      console.log("All done");
      var repos = {};
      var total = 0;
      var common_repos = [];
      for(var i = 0; i < fm.length; i++){
        repos[fm[i].id] = fm[i];
      }
      for(var i = 0; i < fo.length; i++){
        repos[fo[i].id] = fo[i];
      }
      for(var i = 0; i < sm.length; i++){
        if(repos[sm[i].id]){
          total++;
          common_repos.push(sm[i]);
        }
      }
      for(var i = 0; i < so.length; i++){
        if(repos[so[i].id]){
          total++;
          common_repos.push(so[i]);
        }
      }
      $('#total').html('');
      $('#repos').html('<ul>');

      $('#total').html('<h4>'+total+'</h4>');
      for(var i = 0; i < common_repos.length; i++){
        $('#repos').append('<li>'+common_repos[i].name+'</li>');
      }
      $('#repos').append('</ul>');
    });
  }
  function findCommonfollowers() {
    var first = $('#first').val();
    var second = $('#second').val();
    var firstmember = $.ajax({
      url : 'https://api.github.com/users/'+first+'/followers',
      method : 'GET'
    });
    var secondmember = $.ajax({
      url : 'https://api.github.com/users/'+second+'/followers',
      method : 'GET'
    });
    $.when(firstmember,secondmember).done(function(fm,sm){
      fm = fm[0];
      sm = sm[0];
      var repos = {};
      var total = 0;
      var common_followers = [];
      for(var i = 0; i < fm.length; i++){
        repos[fm[i].id] = fm[i];
      }
      for(var i = 0; i < sm.length; i++){
        if(repos[sm[i].id]){
          total++;
          common_followers.push(sm[i]);
        }
      }
      $('#total').html('');
      $('#repos').html('<ul>');

      $('#total').html('<h4>'+total+'</h4>');
      for(var i = 0; i < common_followers.length; i++){
        $('#repos').append('<li>'+common_followers[i].name+'</li>');
      }
      $('#repos').append('</ul>');
    });
  }
  </script>
</html>
